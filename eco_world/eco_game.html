<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∞—Ä–±–æ–°–≤—ñ—Ç: –ö–≤–µ—Å—Ç –û—Ö–æ—Ä–æ–Ω—Ü—è</title>
    <style>
        body {
            font-family: 'Verdana', sans-serif;
            background-color: #eef;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 10px;
            user-select: none;
        }

        /* –°—Ç–∏–ª—å –∫–≤–µ—Å—Ç-–ø–∞–Ω–µ–ª—ñ */
        #quest-panel {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 15px 30px;
            border-radius: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: center;
            width: 550px;
            border: 3px solid #fff;
        }
        #quest-title { font-size: 14px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9; }
        #quest-goal { font-size: 22px; font-weight: bold; margin-top: 5px; }

        #game-container {
            position: relative;
            width: 600px;
            height: 400px;
            border: 5px solid #444;
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(to bottom, #87CEEB, #e0f7fa);
            cursor: crosshair;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        /* –ü–µ—Ä–µ–º–æ–≥–∞ / –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10;
            display: none; /* –°—Ö–æ–≤–∞–Ω–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
        }
        #overlay h2 { font-size: 40px; margin: 0; color: #FFD700; text-shadow: 2px 2px 0 #000; }
        #next-btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 5px 0 #1e7e34;
        }
        #next-btn:active { transform: translateY(5px); box-shadow: none; }

        /* –ü–∞–Ω–µ–ª—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ */
        #controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        .btn {
            width: 65px; height: 65px;
            border: none; border-radius: 12px;
            font-size: 24px; cursor: pointer;
            background: #fff; border: 2px solid #ccc;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .btn.active { border-color: #000; background: #e0e0e0; transform: scale(1.1); }
        .btn span { font-size: 9px; margin-top: 4px; font-weight: bold; }

        /* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ */
        #stats { width: 600px; display: flex; justify-content: space-between; margin-top: 5px; font-weight: bold; font-size: 14px; }
        .bar-wrap { width: 80px; height: 10px; background: #ddd; border: 1px solid #333; border-radius: 5px; overflow: hidden; display: inline-block; vertical-align: middle;}
        .bar { height: 100%; width: 50%; transition: width 0.3s; }

    </style>
</head>
<body>

    <div id="quest-panel">
        <div id="quest-title">–†—ñ–≤–µ–Ω—å 1: –ü–æ—á–∞—Ç–æ–∫ –∂–∏—Ç—Ç—è</div>
        <div id="quest-goal">–¶—ñ–ª—å: –í–∏—Ä–æ—Å—Ç–∏ 3 –∑–¥–æ—Ä–æ–≤–∏—Ö –¥–µ—Ä–µ–≤–∞ (0/3)</div>
    </div>

    <div id="stats">
        <div>‚òÄÔ∏è <div class="bar-wrap"><div id="sun-bar" class="bar" style="background:orange"></div></div></div>
        <div>üíß <div class="bar-wrap"><div id="water-bar" class="bar" style="background:blue"></div></div></div>
        <div id="status-text" style="color: green">–ë–∞–ª–∞–Ω—Å –≤ –Ω–æ—Ä–º—ñ</div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        
        <div id="overlay">
            <h2>üèÜ –ü–ï–†–ï–ú–û–ì–ê!</h2>
            <p>–¢–∏ –≤–ø–æ—Ä–∞–≤—Å—è! –ü—Ä–∏—Ä–æ–¥–∞ –æ–∂–∏–≤–∞—î.</p>
            <button id="next-btn" onclick="nextLevel()">–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä—ñ–≤–µ–Ω—å ‚ñ∂</button>
        </div>
    </div>

    <div id="controls">
        <button class="btn active" onclick="setTool('sun')" id="btn-sun">‚òÄÔ∏è<span>–°–æ–Ω—Ü–µ</span></button>
        <button class="btn" onclick="setTool('water')" id="btn-water">üíß<span>–î–æ—â</span></button>
        <button class="btn" onclick="setTool('plant')" id="btn-plant">üå≥<span>–°–∞–¥–∂–∞—Ç–∏</span></button>
        <button class="btn" onclick="setTool('animal')" id="btn-animal">üêá<span>–¢–≤–∞—Ä–∏–Ω–∏</span></button>
        <button class="btn" onclick="setTool('clean')" id="btn-clean">üßπ<span>–ü—Ä–∏–±—Ä–∞—Ç–∏</span></button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –†–Ü–í–ù–Ü–í ---
        const levels = [
            {
                id: 1,
                title: "–†—ñ–≤–µ–Ω—å 1: –ü–æ—á–∞—Ç–æ–∫ –∂–∏—Ç—Ç—è",
                desc: "–í–∏—Ä–æ—Å—Ç–∏ 5 –∑–¥–æ—Ä–æ–≤–∏—Ö –¥–µ—Ä–µ–≤.",
                goal: (state) => countType(state, 'tree') >= 5,
                text: "–¶—ñ–ª—å: 5 –¥–µ—Ä–µ–≤ (–ó–∞—Ä–∞–∑: {val})"
            },
            {
                id: 2,
                title: "–†—ñ–≤–µ–Ω—å 2: –ó–∞—Å–µ–ª–µ–Ω–Ω—è",
                desc: "–°—Ç–≤–æ—Ä–∏ –ª—ñ—Å —ñ –∑–∞—Å–µ–ª–∏ 3 –∑–∞–π—Ü—ñ–≤.",
                goal: (state) => countType(state, 'rabbit') >= 3,
                text: "–¶—ñ–ª—å: 3 –∑–∞–π—Ü—ñ (–ó–∞—Ä–∞–∑: {val})"
            },
            {
                id: 3,
                title: "–†—ñ–≤–µ–Ω—å 3: –ß–∏—Å—Ç–æ—Ç–∞",
                desc: "–ü—Ä–∏–±–µ—Ä–∏ –≤—Å–µ —Å–º—ñ—Ç—Ç—è —Ç–∞ –∑–±–µ—Ä–µ–∂–∏ 5 –¥–µ—Ä–µ–≤ –∂–∏–≤–∏–º–∏.",
                goal: (state) => countType(state, 'trash') === 0 && countType(state, 'tree') >= 5 && state.totalTrashCleaned >= 5,
                text: "–ü—Ä–∏–±—Ä–∞—Ç–∏ 5 —Å–º—ñ—Ç—Ç—è —ñ –º–∞—Ç–∏ 5 –¥–µ—Ä–µ–≤. (–ü—Ä–∏–±—Ä–∞–Ω–æ: {val})"
            }
        ];

        let currentLevelIdx = 0;
        let isLevelComplete = false;

        // --- –°–¢–ê–ù –ì–†–ò ---
        let state = {
            sun: 50,
            water: 50,
            objects: [],
            tool: 'sun',
            totalTrashCleaned: 0 // –õ—ñ—á–∏–ª—å–Ω–∏–∫ –¥–ª—è 3 —Ä—ñ–≤–Ω—è
        };

        const GROUND_Y = 350;

        // --- –£–ü–†–ê–í–õ–Ü–ù–ù–Ø ---
        canvas.addEventListener('mousedown', (e) => {
            if (isLevelComplete) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (state.tool === 'sun') {
                state.sun = Math.min(state.sun + 10, 100);
                state.water = Math.max(state.water - 5, 0);
            } else if (state.tool === 'water') {
                state.water = Math.min(state.water + 10, 100);
                state.sun = Math.max(state.sun - 5, 0);
            } else if (state.tool === 'plant') {
                state.objects.push({ type: 'tree', x: x, y: GROUND_Y, status: 'alive' });
            } else if (state.tool === 'animal') {
                if (countType(state, 'tree') >= 2) {
                    state.objects.push({ type: 'rabbit', x: x, y: GROUND_Y, status: 'alive', dir: 1 });
                } else {
                    alert("–°–ø–æ—á–∞—Ç–∫—É –ø–æ—Å–∞–¥–∏ –±—ñ–ª—å—à–µ –¥–µ—Ä–µ–≤!");
                }
            } else if (state.tool === 'clean') {
                // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–º—ñ—Ç—Ç—è
                let beforeCount = state.objects.length;
                state.objects = state.objects.filter(o => !(o.type === 'trash' && Math.abs(o.x - x) < 30));
                if (state.objects.length < beforeCount) {
                    state.totalTrashCleaned++;
                }
            }
            updateGameLogic();
        });

        function setTool(t) {
            state.tool = t;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + t).classList.add('active');
        }

        function countType(st, type) {
            return st.objects.filter(o => o.type === type && o.status === 'alive').length;
        }

        // --- –õ–û–ì–Ü–ö–ê –ì–†–ò ---
        function updateGameLogic() {
            // –ï–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ñ —É–º–æ–≤–∏
            let isBad = state.sun > 80 || state.water > 80;
            let statusText = document.getElementById('status-text');

            if (state.sun > 80) { statusText.innerText = "üî• –°–ø–µ–∫–∞!"; statusText.style.color = "red"; }
            else if (state.water > 80) { statusText.innerText = "üåä –ü–æ–≤—ñ–Ω—å!"; statusText.style.color = "blue"; }
            else { statusText.innerText = "‚ú® –ë–∞–ª–∞–Ω—Å"; statusText.style.color = "green"; }

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
            state.objects.forEach(obj => {
                if (obj.type === 'tree') {
                    if (isBad) obj.status = 'dead';
                    else if (state.sun > 20 && state.water > 20) obj.status = 'alive';
                }
                if (obj.type === 'rabbit') {
                    obj.x += obj.dir * 2;
                    if (obj.x > 580 || obj.x < 20) obj.dir *= -1;
                    if (countType(state, 'tree') === 0 || isBad) obj.status = 'gone'; // –í—Ç—ñ–∫–∞—é—Ç—å –±–µ–∑ –ª—ñ—Å—É
                }
            });
            state.objects = state.objects.filter(o => o.status !== 'gone');

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ö–í–ï–°–¢–£
            checkQuest();
        }

        function checkQuest() {
            let lvl = levels[currentLevelIdx];
            let val = 0;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Ç–µ–∫—Å—Ç –∑–∞–≤–¥–∞–Ω–Ω—è
            if (currentLevelIdx === 0) val = countType(state, 'tree');
            if (currentLevelIdx === 1) val = countType(state, 'rabbit');
            if (currentLevelIdx === 2) val = state.totalTrashCleaned;

            let goalText = lvl.text.replace("{val}", val);
            document.getElementById('quest-goal').innerText = goalText;

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–º–æ–≥–∏
            if (lvl.goal(state) && !isLevelComplete) {
                isLevelComplete = true;
                document.getElementById('overlay').style.display = 'flex';
            }
        }

        function nextLevel() {
            currentLevelIdx++;
            if (currentLevelIdx >= levels.length) {
                alert("–¢–∏ –ø—Ä–æ–π—à–æ–≤ —É—Å—é –≥—Ä—É! –¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –º–∞–π—Å—Ç–µ—Ä –ø—Ä–∏—Ä–æ–¥–∏!");
                currentLevelIdx = 0; // –ü–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É
            }
            
            // –°–∫–∏–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è
            state.objects = [];
            state.sun = 50; state.water = 50;
            state.totalTrashCleaned = 0;
            isLevelComplete = false;
            document.getElementById('overlay').style.display = 'none';
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤
            document.getElementById('quest-title').innerText = levels[currentLevelIdx].title;
            checkQuest();
        }

        // --- –ú–ê–õ–Æ–í–ê–ù–ù–Ø ---
        function draw() {
            ctx.clearRect(0,0,600,400);

            // –ù–µ–±–æ
            let r=135, g=206, b=235;
            if (state.sun > 70) { r=255; g=250; b=200; }
            if (state.water > 70) { r=100; g=100; b=160; }
            ctx.fillStyle = `rgb(${r},${g},${b})`;
            ctx.fillRect(0,0,600,400);

            // –°–æ–Ω—Ü–µ
            ctx.beginPath(); ctx.arc(500, 60, 40, 0, Math.PI*2);
            ctx.fillStyle = `rgba(255, 215, 0, ${state.sun/80})`; ctx.fill();

            // –ó–µ–º–ª—è
            let gh = (state.water > 80) ? 120 : 50;
            ctx.fillStyle = (state.sun > 80) ? "#D2B48C" : "#228B22";
            if (state.water > 80) ctx.fillStyle = "#1E90FF";
            ctx.fillRect(0, 400-gh, 600, gh);

            // –û–±'—î–∫—Ç–∏
            ctx.font = "30px Arial"; ctx.textAlign = "center";
            state.objects.forEach(o => {
                let txt = "";
                let y = o.y;
                if (o.type === 'tree') txt = (o.status === 'alive') ? "üå≥" : "üçÇ";
                if (o.type === 'rabbit') { txt = "üêá"; y -= 10; }
                if (o.type === 'trash') { txt = "üóëÔ∏è"; y = GROUND_Y + 10; }
                
                if (state.water > 80) y = 400 - gh + 20;
                ctx.fillText(txt, o.x, y);
            });

            // –î–æ—â
            if (state.water > 60) {
                ctx.fillStyle = "rgba(0,0,200,0.5)";
                for(let i=0; i<state.water; i++) ctx.fillRect(Math.random()*600, Math.random()*400, 2, 8);
            }

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —à–∫–∞–ª
            document.getElementById('sun-bar').style.width = state.sun + "%";
            document.getElementById('water-bar').style.width = state.water + "%";
        }

        // --- –¶–ò–ö–õ –ì–†–ò ---
        setInterval(() => {
            if (!isLevelComplete) {
                if (state.sun > 10) state.sun -= 0.5;
                if (state.water > 10) state.water -= 0.5;
                
                // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–º—ñ—Ç—Ç—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ 3 —Ä—ñ–≤–Ω—ñ
                if (currentLevelIdx === 2 && Math.random() > 0.98) {
                    state.objects.push({type:'trash', x: Math.random()*580+10, y: GROUND_Y});
                }
                
                updateGameLogic();
            }
            draw();
        }, 100); // 10 FPS (–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è —Ç–∞–∫–æ—ó –≥—Ä–∏)

        // –°—Ç–∞—Ä—Ç
        checkQuest();

    </script>
</body>
</html>