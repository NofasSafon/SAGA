<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∞—Ä–±–æ–°–≤—ñ—Ç: –ï–∫–æ-–ë–∞–ª–∞–Ω—Å 2.0</title>
    <style>
        body {
            font-family: 'Comic Sans MS', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 10px;
            user-select: none; /* –©–æ–± —Ç–µ–∫—Å—Ç –Ω–µ –≤–∏–¥—ñ–ª—è–≤—Å—è –ø—Ä–∏ —à–≤–∏–¥–∫–æ–º—É –∫–ª—ñ–∫–∞–Ω–Ω—ñ */
        }

        h1 { margin: 5px; font-size: 24px; color: #333; }

        #game-wrapper {
            position: relative;
        }

        #game-container {
            position: relative;
            width: 600px;
            height: 400px;
            border: 5px solid #444;
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(to bottom, #87CEEB, #e0f7fa);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            cursor: crosshair;
        }

        canvas { display: block; }

        /* –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è */
        #controls {
            margin-top: 15px;
            display: flex;
            gap: 15px;
            padding: 10px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn {
            width: 70px;
            height: 70px;
            border: none;
            border-radius: 15px;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background: #eee;
        }

        .btn:active { transform: scale(0.95); }
        .btn span { font-size: 10px; font-weight: bold; margin-top: 5px; }

        .btn.active { border: 3px solid #333; transform: scale(1.05); }

        #btn-sun { background: #FFD700; color: #fff; text-shadow: 1px 1px 0 #000;}
        #btn-water { background: #1E90FF; color: #fff; text-shadow: 1px 1px 0 #000;}
        #btn-plant { background: #32CD32; color: #fff; text-shadow: 1px 1px 0 #000;}
        #btn-animal { background: #FF69B4; color: #fff; text-shadow: 1px 1px 0 #000;}
        #btn-clean { background: #fff; border: 2px solid #ccc; color: #333; }

        /* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ */
        #stats {
            width: 600px;
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }
        
        .stat-box { display: flex; align-items: center; gap: 5px; font-size: 14px; }
        .bar-container { width: 80px; height: 10px; background: #ddd; border-radius: 5px; border: 1px solid #333; overflow: hidden;}
        .bar { height: 100%; transition: width 0.3s; }
        
        #message {
            margin-top: 5px;
            font-size: 18px;
            font-weight: bold;
            color: #d32f2f;
            min-height: 25px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>üåç –§–∞—Ä–±–æ–°–≤—ñ—Ç: –ñ–∏–≤–∞ –ü–ª–∞–Ω–µ—Ç–∞</h1>
    
    <div id="stats">
        <div class="stat-box">‚òÄÔ∏è –¢–µ–ø–ª–æ: <div class="bar-container"><div id="sun-bar" class="bar" style="background:orange"></div></div></div>
        <div class="stat-box">üíß –í–æ–ª–æ–≥–∞: <div class="bar-container"><div id="water-bar" class="bar" style="background:blue"></div></div></div>
        <div class="stat-box">üå≤ –î–µ—Ä–µ–≤: <span id="tree-count">0</span></div>
        <div class="stat-box">üêá –¢–≤–∞—Ä–∏–Ω: <span id="animal-count">0</span></div>
    </div>

    <div id="message"></div>

    <div id="game-wrapper">
        <div id="game-container">
            <canvas id="gameCanvas" width="600" height="400"></canvas>
        </div>
    </div>

    <div id="controls">
        <button class="btn" onclick="setTool('sun')">‚òÄÔ∏è<span>–°–æ–Ω—Ü–µ</span></button>
        <button class="btn" onclick="setTool('water')">üíß<span>–î–æ—â</span></button>
        <button class="btn" onclick="setTool('plant')">üå≥<span>–°–∞–¥–∂–∞—Ç–∏</span></button>
        <button class="btn" onclick="setTool('animal')">üêá<span>–ó–∞—Å–µ–ª–∏—Ç–∏</span></button>
        <button class="btn" onclick="setTool('clean')">üßπ<span>–ü—Ä–∏–±—Ä–∞—Ç–∏</span></button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const msgBox = document.getElementById('message');

        // –°—Ç–∞–Ω –≥—Ä–∏
        let state = {
            sun: 50,
            water: 50,
            objects: [], // –î–µ—Ä–µ–≤–∞, —Ç–≤–∞—Ä–∏–Ω–∏, —Å–º—ñ—Ç—Ç—è
            tool: 'sun', // –ü–æ—Ç–æ—á–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
            gameLoop: null
        };

        const GROUND_Y = 350;

        // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—ñ–≤ –ø–æ –ø–æ–ª–æ—Ç–Ω—É
        canvas.addEventListener('mousedown', (e) => handleInput(e));
        
        function setTool(toolName) {
            state.tool = toolName;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –∫–Ω–æ–ø–∫—É –∑–∞ —Ç–µ–∫—Å—Ç–æ–º –∞–±–æ id, —Ç—É—Ç –ø—Ä–æ—Å—Ç–æ –¥–ª—è –≤—ñ–∑—É–∞–ª—É
            msgBox.innerText = `–û–±—Ä–∞–Ω–æ: ${getToolName(toolName)}`;
        }

        function getToolName(t) {
            if(t==='sun') return "–ö–µ—Ä—É–≤–∞–Ω–Ω—è –°–æ–Ω—Ü–µ–º";
            if(t==='water') return "–ö–µ—Ä—É–≤–∞–Ω–Ω—è –î–æ—â–µ–º";
            if(t==='plant') return "–°–∞–¥–∂–∞–Ω–Ω—è –¥–µ—Ä–µ–≤";
            if(t==='animal') return "–ó–∞—Å–µ–ª–µ–Ω–Ω—è —Ç–≤–∞—Ä–∏–Ω";
            if(t==='clean') return "–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è —Å–º—ñ—Ç—Ç—è";
        }

        function handleInput(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (state.tool === 'sun') {
                state.sun = Math.min(state.sun + 15, 100);
                state.water = Math.max(state.water - 5, 0);
            } else if (state.tool === 'water') {
                state.water = Math.min(state.water + 15, 100);
                state.sun = Math.max(state.sun - 5, 0);
            } else if (state.tool === 'plant') {
                // –°–∞–¥–∂–∞—î–º–æ –¥–µ—Ä–µ–≤–æ
                state.objects.push({ type: 'tree', x: x, y: GROUND_Y, status: 'alive', age: 0 });
            } else if (state.tool === 'animal') {
                // –ó–∞—Å–µ–ª—è—î–º–æ —Ç–≤–∞—Ä–∏–Ω—É (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î —É–º–æ–≤–∏)
                let liveTrees = state.objects.filter(o => o.type === 'tree' && o.status === 'alive').length;
                if (liveTrees >= 2) {
                    state.objects.push({ type: 'rabbit', x: x, y: GROUND_Y, status: 'alive', dir: 1 });
                } else {
                    msgBox.innerText = "‚ùå –¢—Ä–µ–±–∞ –±—ñ–ª—å—à–µ –¥–µ—Ä–µ–≤ –¥–ª—è –∑–∞–π—á–∏–∫—ñ–≤!";
                }
            } else if (state.tool === 'clean') {
                // –í–∏–¥–∞–ª—è—î–º–æ —Å–º—ñ—Ç—Ç—è –ø–æ—Ä—É—á —ñ–∑ –∫–ª—ñ–∫–æ–º
                state.objects = state.objects.filter(o => {
                    if (o.type === 'trash') {
                        let dist = Math.abs(o.x - x);
                        if (dist < 30) return false; // –í–∏–¥–∞–ª—è—î–º–æ
                    }
                    return true;
                });
            }
            updateLogic();
        }

        // --- –õ–û–ì–Ü–ö–ê ---
        function updateLogic() {
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –µ–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∏—Ö —É–º–æ–≤
            let isDrought = state.sun > 80;
            let isFlood = state.water > 80;

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
            state.objects.forEach(obj => {
                if (obj.type === 'tree') {
                    if (isDrought) obj.status = 'dead_dry';
                    else if (isFlood) obj.status = 'dead_wet';
                    else if (state.sun > 30 && state.water > 30) obj.status = 'alive';
                }
                
                if (obj.type === 'rabbit') {
                    // –ó–∞–π—Ü—ñ –±—ñ–≥–∞—é—Ç—å
                    obj.x += obj.dir * 2;
                    if (obj.x > canvas.width - 20 || obj.x < 20) obj.dir *= -1;

                    // –Ø–∫—â–æ –¥–µ—Ä–µ–≤–∞ –ø–æ–º–µ—Ä–ª–∏ - –∑–∞–π—Ü—ñ —Ç–µ–∂ –∑–Ω–∏–∫–∞—é—Ç—å (—Ç—ñ–∫–∞—é—Ç—å)
                    let liveTrees = state.objects.filter(o => o.type === 'tree' && o.status === 'alive').length;
                    if (liveTrees === 0 || isFlood || isDrought) {
                        obj.status = 'gone'; 
                    }
                }
            });

            // –í–∏–¥–∞–ª—è—î–º–æ —Ç–∏—Ö, —Ö—Ç–æ –≤—Ç—ñ–∫
            state.objects = state.objects.filter(o => o.status !== 'gone');
        }

        // --- –ú–ê–õ–Æ–í–ê–ù–ù–Ø ---
        function draw() {
            // –§–æ–Ω –Ω–µ–±–∞
            let r = 135, g = 206, b = 235; // SkyBlue
            if (state.sun > 70) { r=255; g=240; b=200; } // –ñ–æ–≤—Ç—É–≤–∞—Ç–µ
            if (state.water > 70) { r=100; g=100; b=150; } // –¢–µ–º–Ω–µ
            ctx.fillStyle = `rgb(${r},${g},${b})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –°–æ–Ω—Ü–µ
            ctx.beginPath();
            ctx.arc(500, 60, 40, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255, 215, 0, ${state.sun / 80})`;
            ctx.fill();

            // –î–æ—â
            if (state.water > 60) {
                ctx.fillStyle = "rgba(0, 0, 200, 0.5)";
                for(let i=0; i<state.water; i++) ctx.fillRect(Math.random()*600, Math.random()*400, 2, 8);
            }

            // –ó–µ–º–ª—è
            let groundH = 50;
            if (state.water > 80) groundH = 120; // –ü–æ–≤—ñ–Ω—å
            ctx.fillStyle = state.sun > 80 ? "#D2B48C" : "#228B22"; 
            if (state.water > 80) ctx.fillStyle = "#1E90FF";
            ctx.fillRect(0, canvas.height - groundH, canvas.width, groundH);

            // –û–±'—î–∫—Ç–∏
            ctx.font = "30px Arial";
            ctx.textAlign = "center";
            state.objects.forEach(obj => {
                let emoji = "";
                let y = obj.y;
                
                if (obj.type === 'tree') {
                    if (obj.status === 'alive') emoji = "üå≥";
                    else if (obj.status === 'dead_dry') emoji = "üçÇ";
                    else if (obj.status === 'dead_wet') { emoji = "ü™∏"; y += 10; }
                } else if (obj.type === 'rabbit') {
                    emoji = "üêá";
                    y -= 10; // –¢—Ä–æ—Ö–∏ –≤–∏—â–µ
                } else if (obj.type === 'trash') {
                    emoji = "üóëÔ∏è";
                    y = GROUND_Y + 10;
                }
                
                if(state.water > 80) y = canvas.height - groundH + 20; // –í—Å–µ –ø—ñ–¥ –≤–æ–¥–æ—é

                ctx.fillText(emoji, obj.x, y);
            });

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI
            document.getElementById('sun-bar').style.width = state.sun + '%';
            document.getElementById('water-bar').style.width = state.water + '%';
            
            let trees = state.objects.filter(o => o.type === 'tree' && o.status === 'alive').length;
            let animals = state.objects.filter(o => o.type === 'rabbit').length;
            document.getElementById('tree-count').innerText = trees;
            document.getElementById('animal-count').innerText = animals;
        }

        // --- –ì–ï–ù–ï–†–ê–¢–û–† –ü–û–î–Ü–ô ---
        // –†–∞–∑ –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏ –º–æ–∂–µ –∑'—è–≤–∏—Ç–∏—Å—è —Å–º—ñ—Ç—Ç—è
        setInterval(() => {
            if (Math.random() > 0.7) {
                state.objects.push({ 
                    type: 'trash', 
                    x: Math.random() * (canvas.width - 40) + 20, 
                    y: GROUND_Y 
                });
                msgBox.innerText = "‚ö†Ô∏è –•—Ç–æ—Å—å –Ω–∞—Å–º—ñ—Ç–∏–≤! –ü—Ä–∏–±–µ—Ä–∏ —Ü–µ!";
            }
        }, 3000);

        // –ü–æ—Å—Ç—ñ–π–Ω–µ –∑–Ω–∏–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
        setInterval(() => {
            if(state.sun > 20) state.sun -= 1;
            if(state.water > 20) state.water -= 1;
            updateLogic();
        }, 500);

        // –ì–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –∞–Ω—ñ–º–∞—Ü—ñ—ó
        function loop() {
            draw();
            requestAnimationFrame(loop);
        }
        loop();

    </script>
</body>
  </html>
